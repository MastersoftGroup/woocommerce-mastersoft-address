/*@preserve mastersoft/woocommerce-mastersoft-address*/
jQuery(document).ready(function(e){function n(){s=function(){function e(e){try{var n=JSON.parse("["+e+"]");return"undefined"!=typeof n&&null!=n&&n.length?n[0]:{}}catch(n){return console.error("Error in parsing settings: "+n),console.warn("Possibly incorrect JSON format: "+e),{}}}var n={username:void 0,password:void 0,url:"https://hosted.mastersoftgroup.com",AU:{locale:Harmony.AUSTRALIA,sot:Harmony.GNAF,featureOptions:{singleLineHitNumber:5,caseType:"TITLE"}},NZ:{locale:Harmony.NEW_ZEALAND,sot:Harmony.NZAD,featureOptions:{singleLineHitNumber:5,caseType:"TITLE",exposeAttributes:"1"}},email:{enabled:!1,sot:"VE_ALL",options:[HraEmailJS.OPTIONS.FORMAT,HraEmailJS.OPTIONS.BLOCKLIST,HraEmailJS.OPTIONS.DOMAIN,HraEmailJS.OPTIONS.MAILSERVER,HraEmailJS.OPTIONS.MAILBOX]}},t=php_vars.licenceKey,o=php_vars.url,a=php_vars.widgetLayout,r=php_vars.widgetOptions,i=php_vars.widgetOptionsAu,s=php_vars.widgetOptionsNz,d=php_vars.widgetOptionsEmail,l=!1;if("undefined"!=typeof t&&t&&t.indexOf(":")>0){var u=t.indexOf(":"),c=t.substring(0,u),f=t.substring(u+1,t.length);if(c&&f){if(l=!0,n.username=c,n.password=f,"undefined"!=typeof o&&o&&(n.url=o),"undefined"!=typeof a&&a&&(n.layout=e(a)),"undefined"!=typeof d&&d&&(n.email=e(d)),"undefined"!=typeof r&&r){var p=e(r);Object.keys(p).forEach(function(e){var t=p[e];"sot"!==e&&(n.AU.featureOptions[e]=t,n.NZ.featureOptions[e]=t)})}if("undefined"!=typeof i&&i){var p=e(i);Object.keys(p).forEach(function(e){var t=p[e];"sot"===e?n.AU.sot=t:n.AU.featureOptions[e]=t})}if("undefined"!=typeof s&&s){var p=e(s);Object.keys(p).forEach(function(e){var t=p[e];"sot"===e?n.NZ.sot=t:n.NZ.featureOptions[e]=t})}}}return console.info("Licence key is in "+(l?"VALID":"INVALID")+" format, URL: "+o+", Options: "+r+", AU Options: "+i+", NZ Options: "+s+", Email Options: "+d),n}(),d=php_vars.nzRegionsValKey,e("#"+l+"country").data("val",e("#"+l+"country").val()),e("#"+u+"country").data("val",e("#"+u+"country").val())}function t(n){var t=e("#"+n+"country").val(),a=e("#"+n+"country").data("val");"undefined"!=typeof a&&a&&t!==a&&(r(n),i(n,"company"),o(t,n))}function o(n,t){function a(n,t,o,a,r,i,s,l){function u(e){var n="";if(e.attributes&&e.attributes.regional_council_name){var t=e.attributes.regional_council_name.toUpperCase();t.endsWith(" REGION")&&(t=t.substring(0,t.length-7)),n=d[t.replace(/[^A-Za-z0-9]/g,"")]}return n}if(!document.querySelector("#"+l+"address_1"))return void console.error("address_1 field not found");if(!document.querySelector("#"+l+"country"))return void console.error("country field not found");Harmony.useEnv(n),Harmony.useProtocol(Harmony.CORS),Harmony.init(t,o,r),Harmony.useFeatureOptions(s);var p=HarmonyJS.addressLookup(b(l,f),document.querySelector("#"+l+"country"),i,{minLength:3,getIntlGeocode:!1,onRetrieve:function(n){var t=n.onRetrieveItem,o=[t.streetNumber,t.street].filter(Boolean).join(" "),a=[t.buildingName,t.subdwelling,o,t.postal].filter(Boolean).join(", ");e("#"+l+"address_1").val(a);var i=r==Harmony.AUSTRALIA?t.locality:[t.suburb,t.townCity].filter(Boolean).join(", ");e("#"+l+"city").val(i).change();var s=r==Harmony.AUSTRALIA?t.state.toUpperCase():u(t);e("#"+l+"state").val(s).change(),e("#"+l+"postcode").val(t.postcode)}});c[l]=p.autocomplete}function l(t,a){if(null==document.querySelector("#"+t+"address_lookup")){var i='<p class="form-row address-field validate-required form-row-wide woocommerce-validated" id="'+t+'address_lookup_field" data-priority="50"><label for="'+t+'address_lookup" class="">Address lookup&nbsp;<abbr class="required" title="required">*</abbr></label><span class="woocommerce-input-wrapper"><input type="text" class="input-text " name="'+t+'address_lookup" id="'+t+'address_lookup" placeholder="Type an address to start searching..." data-placeholder=""></span></p>';e("#"+t+"country_field").after(e(i));var s=document.querySelector("#"+t+"address_lookup");e(s).val(u(t)),s.addEventListener("input",function(e){r(t)});var d=t+"show_address_fields_link";if(null==document.querySelector("#"+d)){var l=document.createElement("a");l.id=d,l.href="#",l.text="Can't find your address? Enter manually.",l.onclick=function(e){e.preventDefault(),a[t].disableOptimisation=!0,r(t);var i=document.querySelector("#"+t+"address_lookup_field");i&&i.parentNode.removeChild(i),o(n,t)},s.insertAdjacentElement("afterend",l)}}}function u(n){return[e("#"+n+"address_1").val(),e("#"+n+"address_2").val(),[e("#"+n+"city").val(),e("#"+n+"state").val(),e("#"+n+"postcode").val()].filter(Boolean).join(" ")].filter(Boolean).join(", ")}function p(e){var n=e+"add_businessname",t=document.querySelector("#"+n);if(!t){var o=document.createElement("p");o.classList.add("form-row"),o.classList.add("address-field"),o.classList.add("form-row-wide"),o.id=e+"add_businessname_field",t=document.createElement("a"),t.id=n,t.href="#",t.onclick=function(n){n.preventDefault(),v(e,"company_field")?O(e,"company_field"):(i(e,"company"),_(e,"company_field")),t.text=v(e,"company_field")?"Add business name":"Remove business name"},o.appendChild(t),document.querySelector("#"+e+"last_name_field").insertAdjacentElement("afterend",o)}t.text=v(e,"company_field")?"Add business name":"Remove business name"}function m(e){var n=document.querySelector("#"+e+"address_lookup_field");n&&n.parentNode.removeChild(n);var t=document.querySelector("#"+e+"add_businessname_field");t&&t.parentNode.removeChild(t)}function y(n,t,o){o&&t[n]&&"OPTIMISED"===t[n].layout&&!t[n].disableOptimisation?(""==e("#"+n+"company").val()&&_(n,"company_field"),setTimeout(function(){_(n,"address_1_field"),_(n,"address_2_field"),_(n,"city_field"),_(n,"state_field"),_(n,"postcode_field")},0),l(n,t),p(n)):(O(n,"company_field"),O(n,"address_1_field"),O(n,"address_2_field"),O(n,"city_field"),O(n,"state_field"),O(n,"postcode_field"),m(n))}function v(e,n){return"none"==document.querySelector("#"+e+n).style.display}function _(e,n){document.querySelector("#"+e+n).style.display="none"}function O(e,n){document.querySelector("#"+e+n).style.display=""}function b(e,n){return"OPTIMISED"!==n[e].layout||n[e].disableOptimisation?document.querySelector("#"+e+"address_1"):document.querySelector("#"+e+"address_lookup")}c[t]&&(c[t].destroy(),c[t]=null);var g,h,S;n&&"undefined"!=typeof s[n]&&s[n]&&(g=s[n].locale,h=s[n].sot,S=s[n].featureOptions);var A=s.username,E=s.password,N=s.url;f[t]||(f[t]={disableOptimisation:!1},Object.assign(f[t],s.layout));var I=Boolean("undefined"!=typeof A&&A&&"undefined"!=typeof E&&E&&"undefined"!=typeof g&&g&&"undefined"!=typeof h&&h);y(t,f,I),I&&!f[t].disableOptimisation&&a(N,A,E,f,g,h,S,t)}function a(e,n){var t=document.querySelector("#"+e+"email");if("undefined"==typeof t||!t)return void console.warn("unable to setup email validation - element not found");var o={};Object.assign(o,n),o.enabled&&(o.onError=function(e){e&&e.length?console.error("Email validation error: "+e.join("\n")):console.error("Email validation error")},o.onValidating=function(e){console.debug('Validating "'+e+'"...')},o.onValidated=function(e){console.debug("Email validated - "+(e.isValid?"VALID":"INVALID"))},HraEmailJS.emailValidation(t,o))}function r(e){i(e,"address_1"),i(e,"address_2"),i(e,"city"),i(e,"state"),i(e,"postcode")}function i(n,t){e("#"+n+t).val("").change()}console.info("Mastersoft Address Autocomplete is ready."),console.info("Using jquery "+e.fn.jquery);var s,d,l="billing_",u="shipping_",c={},f={};n(),e("#"+l+"country").length&&o(e("#"+l+"country").val(),l),e("#"+u+"country").length&&o(e("#"+u+"country").val(),u),e("#"+l+"email").length&&a(l,s.email),e("#"+u+"email").length&&a(u,s.email),e("#billing_country").change(function(){t(l),e(this).data("val",e(this).val())}),e("#shipping_country").change(function(){t(u),e(this).data("val",e(this).val())})});