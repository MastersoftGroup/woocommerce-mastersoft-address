/*@preserve mastersoft/woocommerce-mastersoft-address*/
jQuery(document).ready(function(e){function n(){d=function(){function e(e){try{var n=JSON.parse("["+e+"]");return"undefined"!=typeof n&&null!=n&&n.length?n[0]:{}}catch(n){return console.error("Error in parsing settings: "+n),console.warn("Possibly incorrect JSON format: "+e),null}}var n={username:void 0,password:void 0,url:"https://hosted.mastersoftgroup.com",AU:{locale:Harmony.AUSTRALIA,sot:Harmony.GNAF,featureOptions:{singleLineHitNumber:5,caseType:"TITLE"}},NZ:{locale:Harmony.NEW_ZEALAND,sot:Harmony.NZAD,featureOptions:{singleLineHitNumber:5,caseType:"TITLE",exposeAttributes:"1"}},email:{enabled:!1,sot:"VE_ALL",options:[HraEmailJS.OPTIONS.FORMAT,HraEmailJS.OPTIONS.BLOCKLIST,HraEmailJS.OPTIONS.DOMAIN,HraEmailJS.OPTIONS.MAILSERVER,HraEmailJS.OPTIONS.MAILBOX]},phone:{enabled:!1}},o=php_vars.licenceKey,t=php_vars.url,a=php_vars.widgetLayout,r=php_vars.widgetOptions,i=php_vars.widgetOptionsAu,s=php_vars.widgetOptionsNz,l=php_vars.widgetOptionsEmailEnabled,d=php_vars.widgetOptionsEmail,u=php_vars.widgetOptionsPhoneEnabled,c=!1,p=y.setLicenseKey(o);if(p&&p.username&&p.password){if(c=!0,n.username=p.username,n.password=p.password,"undefined"!=typeof t&&t&&(n.url=t),"undefined"!=typeof a&&a&&(n.layout=e(a)||n.layout),"undefined"!=typeof d&&d&&(n.email=e(d)||n.email),n.email.enabled="yes"===l,n.phone.enabled="yes"===u,"undefined"!=typeof r&&r){var f=e(r)||{};Object.keys(f).forEach(function(e){var o=f[e];"sot"!==e&&(n.AU.featureOptions[e]=o,n.NZ.featureOptions[e]=o)})}if("undefined"!=typeof i&&i){var f=e(i)||{};Object.keys(f).forEach(function(e){var o=f[e];"sot"===e?n.AU.sot=o:n.AU.featureOptions[e]=o})}if("undefined"!=typeof s&&s){var f=e(s)||{};Object.keys(f).forEach(function(e){var o=f[e];"sot"===e?n.NZ.sot=o:n.NZ.featureOptions[e]=o})}}return console.info("Licence key is in "+(c?"VALID":"INVALID")+" format, URL: "+t+", Options: "+r+", AU Options: "+i+", NZ Options: "+s+", Email Enabled: "+l+", Email Options: "+d+", Phone Enabled: "+u),n}(),u=php_vars.nzRegionsValKey,e("#"+c+"country").data("val",e("#"+c+"country").val()),e("#"+p+"country").data("val",e("#"+p+"country").val())}function o(n){var o=e("#"+n+"country").val(),a=e("#"+n+"country").data("val");"undefined"!=typeof a&&a&&o!==a&&(i(n),s(n,"company"),t(o,n),l(n))}function t(n,o){function a(n,o,t,a,r,i,s,l){function d(e){var n="";if(e.attributes&&e.attributes.regional_council_name){var o=e.attributes.regional_council_name.toUpperCase();o.endsWith(" REGION")&&(o=o.substring(0,o.length-7)),n=u[o.replace(/[^A-Za-z0-9]/g,"")]}return n}if(!document.querySelector("#"+l+"address_1"))return void console.error("address_1 field not found");if(!document.querySelector("#"+l+"country"))return void console.error("country field not found");y.set({url:n,username:o,password:t,protocol:Harmony.CORS,locale:r,featureOptions:s});var c=HarmonyJS.addressLookup(g(l,m),document.querySelector("#"+l+"country"),i,{minLength:3,getIntlGeocode:!1,onRetrieve:function(n){var o=n.onRetrieveItem,t=[o.streetNumber,o.street].filter(Boolean).join(" "),a=[o.buildingName,o.subdwelling,t,o.postal].filter(Boolean).join(", ");e("#"+l+"address_1").val(a);var i=r==Harmony.AUSTRALIA?o.locality:[o.suburb,o.townCity].filter(Boolean).join(", ");e("#"+l+"city").val(i).change();var s=r==Harmony.AUSTRALIA?o.state.toUpperCase():d(o);e("#"+l+"state").val(s).change(),e("#"+l+"postcode").val(o.postcode)}});f[l]=c.autocomplete}function r(o,a){if(null==document.querySelector("#"+o+"address_lookup")){var r='<p class="form-row address-field validate-required form-row-wide woocommerce-validated" id="'+o+'address_lookup_field" data-priority="50"><label for="'+o+'address_lookup" class="">Address lookup&nbsp;<abbr class="required" title="required">*</abbr></label><span class="woocommerce-input-wrapper"><input type="text" class="input-text " name="'+o+'address_lookup" id="'+o+'address_lookup" placeholder="Type an address to start searching..." data-placeholder=""></span></p>';e("#"+o+"country_field").after(e(r));var s=document.querySelector("#"+o+"address_lookup");e(s).val(l(o)),s.addEventListener("input",function(e){i(o)});var d=o+"show_address_fields_link";if(null==document.querySelector("#"+d)){var u=document.createElement("a");u.id=d,u.href="#",u.text="Can't find your address? Enter manually.",u.onclick=function(e){e.preventDefault(),a[o].disableOptimisation=!0,i(o);var r=document.querySelector("#"+o+"address_lookup_field");r&&r.parentNode.removeChild(r),t(n,o)},s.insertAdjacentElement("afterend",u)}}}function l(n){return[e("#"+n+"address_1").val(),e("#"+n+"address_2").val(),[e("#"+n+"city").val(),e("#"+n+"state").val(),e("#"+n+"postcode").val()].filter(Boolean).join(" ")].filter(Boolean).join(", ")}function c(e){var n=e+"add_businessname",o=document.querySelector("#"+n);if(!o){var t=document.createElement("p");t.classList.add("form-row"),t.classList.add("address-field"),t.classList.add("form-row-wide"),t.id=e+"add_businessname_field",o=document.createElement("a"),o.id=n,o.href="#",o.onclick=function(n){n.preventDefault(),_(e,"company_field")?b(e,"company_field"):(s(e,"company"),h(e,"company_field")),o.text=_(e,"company_field")?"Add business name":"Remove business name"},t.appendChild(o),document.querySelector("#"+e+"last_name_field").insertAdjacentElement("afterend",t)}o.text=_(e,"company_field")?"Add business name":"Remove business name"}function p(e){var n=document.querySelector("#"+e+"address_lookup_field");n&&n.parentNode.removeChild(n);var o=document.querySelector("#"+e+"add_businessname_field");o&&o.parentNode.removeChild(o)}function v(n,o,t){t&&o[n]&&"OPTIMISED"===o[n].layout&&!o[n].disableOptimisation?(""==e("#"+n+"company").val()&&h(n,"company_field"),setTimeout(function(){h(n,"address_1_field"),h(n,"address_2_field"),h(n,"city_field"),h(n,"state_field"),h(n,"postcode_field")},0),r(n,o),c(n)):(b(n,"company_field"),b(n,"address_1_field"),b(n,"address_2_field"),b(n,"city_field"),b(n,"state_field"),b(n,"postcode_field"),p(n))}function _(e,n){return"none"==document.querySelector("#"+e+n).style.display}function h(e,n){document.querySelector("#"+e+n).style.display="none"}function b(e,n){document.querySelector("#"+e+n).style.display=""}function g(e,n){return"OPTIMISED"!==n[e].layout||n[e].disableOptimisation?document.querySelector("#"+e+"address_1"):document.querySelector("#"+e+"address_lookup")}f[o]&&(f[o].destroy(),f[o]=null);var O,S,E;n&&"undefined"!=typeof d[n]&&d[n]&&(O=d[n].locale,S=d[n].sot,E=d[n].featureOptions);var A=d.username,w=d.password,L=d.url;m[o]||(m[o]={disableOptimisation:!1},Object.assign(m[o],d.layout));var N=Boolean("undefined"!=typeof A&&A&&"undefined"!=typeof w&&w&&"undefined"!=typeof O&&O&&"undefined"!=typeof S&&S);v(o,m,N),N&&!m[o].disableOptimisation&&a(L,A,w,m,O,S,E,o)}function a(e,n){var o=document.querySelector("#"+e+"email");if("undefined"==typeof o||!o)return void console.warn("unable to setup email validation - element not found");var t={};Object.assign(t,n),t.enabled&&(t.onError=function(e){e&&e.length?console.error("Email validation error: "+e.join("\n")):console.error("Email validation error")},t.onValidating=function(e){console.debug('Validating "'+e+'"...')},t.onValidated=function(e){console.debug("Email validated - "+(e.isValid?"VALID":"INVALID"))},y.set({url:php_vars.url,protocol:Harmony.CORS}),y.setLicenseKey(php_vars.licenceKey),HraEmailJS.emailValidation(o,t))}function r(n,o){var t=document.querySelector("#"+n+"phone");if("undefined"==typeof t||!t)return void console.warn("unable to setup phone validation - element not found");var a={};Object.assign(a,o),a.enabled&&(a.onError=function(e){console.error("Phone validation error"),e&&e.length&&console.debug(JSON.stringify(e,null,2))},a.onValidating=function(e){console.debug('Validating "'+e+'"...')},a.onValidated=function(e){console.debug("Phone validated - "+e.status),console.debug(JSON.stringify(e,null,2))},a.getCountry=function(){return e("#"+n+"country").val()||""},y.set({url:php_vars.url,protocol:Harmony.CORS}),y.setLicenseKey(php_vars.licenceKey),HraPhoneJS.phoneValidation(t,a))}function i(e){s(e,"address_1"),s(e,"address_2"),s(e,"city"),s(e,"state"),s(e,"postcode")}function s(n,o){e("#"+n+o).val("").change()}function l(n){d&&d.phone&&d.phone.enabled&&e("#"+n+"phone").change()}console.info("Mastersoft Address Autocomplete is ready."),console.info("Using jquery "+e.fn.jquery);var d,u,c="billing_",p="shipping_",f={},m={},y=function(){var e={initCounter:0};return{setLicenseKey:function(n){if("undefined"!=typeof n&&n&&n.indexOf(":")>0){e.initCounter++;var o=n.indexOf(":");return e.username=n.substring(0,o),e.password=n.substring(o+1,n.length),{username:e.username,password:e.password}}return null},set:function(n){e.initCounter++,Object.assign(e,n)},initialize:function(){return e.initCounter<=0?(console.info("Harmony JS client attribute not set."),!1):"undefined"==typeof e.url?(console.error("Harmony JS client attribute not set: environment url"),!1):"undefined"==typeof e.username||"undefined"==typeof e.password?(console.error("Harmony JS client attribute not set: login credential"),!1):"undefined"==typeof e.protocol?(console.error("Harmony JS client attribute not set: protocol"),!1):(Harmony.useEnv(e.url),Harmony.useProtocol(Harmony.CORS),Harmony.init(e.username,e.password,e.locale),Harmony.useFeatureOptions(e.featureOptions),e.initCounter=0,!0)}}}();n(),e("#"+c+"country").length&&t(e("#"+c+"country").val(),c),e("#"+p+"country").length&&t(e("#"+p+"country").val(),p),e("#"+c+"email").length&&a(c,d.email),e("#"+p+"email").length&&a(p,d.email),e("#"+c+"phone").length&&r(c,d.phone),e("#"+p+"phone").length&&r(p,d.phone),y.initialize(),e("#billing_country").change(function(){o(c),e(this).data("val",e(this).val())}),e("#shipping_country").change(function(){o(p),e(this).data("val",e(this).val())})});