/*@preserve mastersoft/woocommerce-mastersoft-address*/
jQuery(document).ready(function(f){console.debug("Loqate AU NZ Address Autocomplete is ready."),console.debug("Using jquery "+f.fn.jquery);var b,h,t,e="billing_",n="shipping_",g={},_={},O=(t={initCounter:0},{setLicenseKey:function(e){var n;return void 0!==e&&e&&0<e.indexOf(":")?(t.initCounter++,n=e.indexOf(":"),t.username=e.substring(0,n),t.password=e.substring(n+1,e.length),{username:t.username,password:t.password}):null},set:function(e){t.initCounter++,Object.assign(t,e)},initialize:function(){return t.initCounter<=0?(console.debug("Harmony JS client attribute not set."),!1):void 0===t.url?(console.error("Harmony JS client attribute not set: environment url"),!1):void 0===t.username||void 0===t.password?(console.error("Harmony JS client attribute not set: login credential"),!1):void 0===t.protocol?(console.error("Harmony JS client attribute not set: protocol"),!1):(Harmony.useEnv(t.url),Harmony.useProtocol(Harmony.CORS),Harmony.init(t.username,t.password,t.locale),Harmony.useFeatureOptions(t.featureOptions),!(t.initCounter=0))}});function o(e,n){var t=f("#"+e+"country").val(),o=f("#"+e+"country").data("val");void 0!==o&&o&&t!==o&&(A(e),E(e,"company"),s(e,n.business),S(t,e),o=e,b)&&b.phone&&b.phone.enabled&&f("#"+o+"phone").change()}function S(r,n){if(g[n]){g[n].destroy();try{delete g[n]}catch(e){console.debug("Error deleting autocomplete instance: "+e),g[n]=void 0}}r&&(i=b[r]||b.INTL)&&(e=i.locale,t=i.sot,o=i.featureOptions);var e,t,o,a,s,l,d,i=b.username,u=b.password,c=b.url,p=(_[n]||(_[n]={disableOptimisation:!1},Object.assign(_[n],b.layout)),Boolean(void 0!==i&&i&&void 0!==u&&u&&void 0!==e&&e&&void 0!==t&&(t||e===Harmony.INTERNATIONAL)));function m(e,n){return"none"==document.querySelector("#"+e+n).style.display}function y(e,n){document.querySelector("#"+e+n).style.display="none"}function v(e,n){document.querySelector("#"+e+n).style.display=""}a=n,s=_,(p&&s[a]&&"OPTIMISED"===s[a].layout&&!s[a].disableOptimisation?(""==f("#"+a+"company").val()&&y(a,"company_field"),setTimeout(function(){y(a,"address_1_field"),y(a,"address_2_field"),y(a,"city_field"),y(a,"state_field"),y(a,"postcode_field")},0),function(n,t){var e,o,a;null==document.querySelector("#"+n+"address_lookup")&&(e='<p class="form-row address-field validate-required form-row-wide woocommerce-validated" id="'+n+'address_lookup_field" data-priority="50"><label for="'+n+'address_lookup" class="">Address lookup&nbsp;<abbr class="required" title="required">*</abbr></label><span class="woocommerce-input-wrapper"><input type="text" class="input-text " name="'+n+'address_lookup" id="'+n+'address_lookup" placeholder="Type an address to start searching..." data-placeholder=""></span></p>',f("#"+n+"country_field").after(f(e)),e=document.querySelector("#"+n+"address_lookup"),f(e).val(function(e){return[f("#"+e+"address_1").val(),f("#"+e+"address_2").val(),[f("#"+e+"city").val(),f("#"+e+"state").val(),f("#"+e+"postcode").val()].filter(Boolean).join(" ")].filter(Boolean).join(", ")}(n)),e.addEventListener("input",function(e){A(n)}),o=n+"show_address_fields_link",null==document.querySelector("#"+o))&&((a=document.createElement("a")).id=o,a.href="#",a.text="Can't find your address? Enter manually.",a.onclick=function(e){e.preventDefault(),t[n].disableOptimisation=!0,A(n);e=document.querySelector("#"+n+"address_lookup_field");e&&e.parentNode.removeChild(e),S(r,n)},e.insertAdjacentElement("afterend",a))}(a,s),function(n){var e=n+"add_businessname",t=document.querySelector("#"+e);{var o;t||((o=document.createElement("p")).classList.add("form-row"),o.classList.add("address-field"),o.classList.add("form-row-wide"),o.id=n+"add_businessname_field",(t=document.createElement("a")).id=e,t.href="#",t.onclick=function(e){e.preventDefault(),(m(n,"company_field")?v:(E(n,"company"),y))(n,"company_field"),t.text=m(n,"company_field")?"Add business name":"Remove business name"},o.appendChild(t),document.querySelector("#"+n+"last_name_field").insertAdjacentElement("afterend",o))}t.text=m(n,"company_field")?"Add business name":"Remove business name"}):(v(a,"company_field"),v(a,"address_1_field"),v(a,"address_2_field"),v(a,"city_field"),v(a,"state_field"),v(a,"postcode_field"),function(e){var n=document.querySelector("#"+e+"address_lookup_field");n&&n.parentNode.removeChild(n);n=document.querySelector("#"+e+"add_businessname_field");n&&n.parentNode.removeChild(n)}))(a),p&&!_[n].disableOptimisation&&(s=c,p=i,c=u,l=e,i=t,u=o,d=n,document.querySelector("#"+d+"address_1")?document.querySelector("#"+d+"country")?(O.set({url:s,username:p,password:c,protocol:Harmony.CORS,locale:l,featureOptions:u}),s=HarmonyJS.addressLookup(function(e,n){return"OPTIMISED"!==n[e].layout||n[e].disableOptimisation?document.querySelector("#"+e+"address_1"):document.querySelector("#"+e+"address_lookup")}(d,_),document.querySelector("#"+d+"country"),i,{minLength:3,getIntlGeocode:!1,onRetrieve:function(e){n=d,t=l,r=e.onRetrieveItem,t===Harmony.AUSTRALIA||t===Harmony.NEW_ZEALAND?(t=[r.streetNumber,r.street].filter(Boolean).join(" "),s=[r.buildingName,r.subdwelling,t,r.postal,r.suburb].filter(Boolean).join(", "),f("#"+n+"address_1").val(s),f("#"+n+"address_2").val("")):(s=[r.attributes.Line1,r.attributes.Line2].filter(Boolean).join(", "),t=[r.attributes.Line3,r.attributes.Line4].filter(Boolean).join(", "),f("#"+n+"address_1").val(s),f("#"+n+"address_2").val(t));var n,t,o,a,r=d,s=e.onRetrieveItem;function i(e,n){f("#"+e+"state").val(n).change();n=f("#"+e+"state").val();return null!=n}s=s.attributes.City,f("#"+r+"city").val(s).change(),n=d,t=l,r=e.onRetrieveItem,o=b.enhancedStateHandling,t===Harmony.NEW_ZEALAND?i(n,function(e){var n="";e.attributes&&e.attributes.regional_council_name&&((e=e.attributes.regional_council_name.toUpperCase()).endsWith(" REGION")&&(e=e.substring(0,e.length-7)),n=h[e.replace(/[^A-Za-z0-9]/g,"")]);return n}(r)):(a=r.attributes.ProvinceName||r.attributes.ProvinceCode,i(n,a)||void 0!==(t=f("#"+n+"state option").filter(function(){return f(this).text()===a}).map(function(){return f(this).val()}).first())&&t&&i(n,t)||o&&(console.debug("Injecting retrieved state: "+a),f("#"+n+"state").append(f("<option>",{value:a,text:a})),i(n,a))||console.debug("Unable to select state: "+a)),r=e.onRetrieveItem,f("#"+d+"postcode").val(r.postcode)}}),g[d]=s.autocomplete):console.error("country field not found"):console.error("address_1 field not found"))}function a(e,n){var t,e=document.querySelector("#"+e+"email");void 0!==e&&e?(t={},Object.assign(t,n),t.enabled&&(t.onError=function(e){e&&e.length?console.error("Email validation error: "+e.join("\n")):console.error("Email validation error")},t.onValidating=function(e){console.debug('Validating "'+e+'"...')},t.onValidated=function(e){console.debug("Email validated - "+(e.isValid?"VALID":"INVALID"))},O.set({url:php_vars.url,protocol:Harmony.CORS}),O.setLicenseKey(php_vars.licenceKey),HraEmailJS.emailValidation(e,t))):console.warn("unable to setup email validation - element not found")}function r(e,n){var t,o=document.querySelector("#"+e+"phone");void 0!==o&&o?(t={},Object.assign(t,n),t.enabled&&(o.placeholder="Must be in international format e.g +61 XXX XXXX",t.onError=function(e){console.error("Phone validation error"),e&&e.length&&console.debug(JSON.stringify(e,null,2))},t.onValidating=function(e){console.debug('Validating "'+e+'"...')},t.onValidated=function(e){console.debug("Phone validated - "+e.status),console.debug(JSON.stringify(e,null,2))},t.getCountry=function(){return f("#"+e+"country").val()||""},O.set({url:php_vars.url,protocol:Harmony.CORS}),O.setLicenseKey(php_vars.licenceKey),HraPhoneJS.phoneValidation(o,t))):console.warn("unable to setup phone validation - element not found")}function s(e,n){if(n.enabled){var t=e+"company";if(g[t]){g[t].destroy();try{delete g[t]}catch(e){console.debug("Error deleting autocomplete instance: "+e),g[t]=void 0}}var o,a,r=document.querySelector("#"+t);void 0!==r&&r?(void 0!==(e=document.querySelector("#"+e+"country"))&&e||(console.debug("country element not found, assume default country (AU)"),e={value:Harmony.AUSTRALIA}),e.value.toUpperCase()!==Harmony.AUSTRALIA.toUpperCase()&&e.value.toUpperCase()!==Harmony.NEW_ZEALAND.toUpperCase()?console.debug("Business lookup not supported for country: "+e.value):(o={},Object.assign(o,n.featureOptions),o.country=e,Array.isArray(o.state)&&(o.state={value:o.state.join(",")}),Array.isArray(o.nameTypes)&&(o.nameTypes={value:o.nameTypes.join(",")}),a=n.displayRetrievedName,o.onRetrieve=function(e){a||(r.value=e.name)},O.set({url:php_vars.url,protocol:Harmony.CORS}),O.setLicenseKey(php_vars.licenceKey),g[t]=HraBusinessJS.businessAutoComplete(r,o).autocomplete)):console.warn("unable to setup company name autocomplete - element not found")}}function A(e){E(e,"address_1"),E(e,"address_2"),E(e,"city"),E(e,"state"),E(e,"postcode")}function E(e,n){f("#"+e+n).val("").change()}b=function(){var t,o={username:void 0,password:void 0,url:"https://hosted.mastersoftgroup.com",AU:{locale:Harmony.AUSTRALIA,sot:Harmony.GNAF,featureOptions:{singleLineHitNumber:5,caseType:"TITLE"}},NZ:{locale:Harmony.NEW_ZEALAND,sot:Harmony.NZAD,featureOptions:{singleLineHitNumber:5,caseType:"TITLE",exposeAttributes:"1"}},INTL:{locale:Harmony.INTERNATIONAL,sot:"",featureOptions:{singleLineHitNumber:5,caseType:"TITLE"}},business:{enabled:!1,featureOptions:{country:"au",hits:5,caseType:"TITLE",bnStatus:"",taxStatus:"",state:["NSW","VIC","QLD","ACT","SA","WA","NT"],nameTypes:["MN","BN","TRD","OTN","LGL","DGR"]}},email:{enabled:!1,sot:"VE_ALL",options:[HraEmailJS.OPTIONS.FORMAT,HraEmailJS.OPTIONS.BLOCKLIST,HraEmailJS.OPTIONS.DOMAIN,HraEmailJS.OPTIONS.MAILSERVER,HraEmailJS.OPTIONS.MAILBOX]},phone:{enabled:!1}},e=php_vars.licenceKey,n=php_vars.url,a=php_vars.widgetLayout,r=php_vars.widgetOptions,s=php_vars.widgetOptionsAu,i=php_vars.widgetOptionsNz,l=php_vars.widgetOptionsEnhancedState,d=php_vars.widgetOptionsBusinessEnabled,u=php_vars.widgetOptionsBusiness,c=php_vars.widgetOptionsBusinessRetrieveName,p=php_vars.widgetOptionsEmailEnabled,m=php_vars.widgetOptionsEmail,y=php_vars.widgetOptionsPhoneEnabled,v=!1,e=O.setLicenseKey(e);function f(n){try{var e=JSON.parse("["+n+"]");return void 0!==e&&null!=e&&e.length?e[0]:{}}catch(e){return console.error("Error in parsing settings: "+e),console.warn("Possibly incorrect JSON format: "+n),null}}return e&&e.username&&e.password&&(v=!0,o.username=e.username,o.password=e.password,void 0!==n&&n&&(o.url=n),void 0!==a&&a&&(o.layout=f(a)||o.layout),void 0!==m&&m&&(o.email=f(m)||o.email),o.email.enabled="yes"===p,o.phone.enabled="yes"===y,void 0!==r&&r&&(t=f(r)||{},Object.keys(t).forEach(function(e){var n=t[e];"sot"!==e&&(o.AU.featureOptions[e]=n,o.NZ.featureOptions[e]=n,o.INTL.featureOptions[e]=n,o.business.featureOptions[e]=n)})),void 0!==s&&s&&(t=f(s)||{},Object.keys(t).forEach(function(e){var n=t[e];"sot"===e?o.AU.sot=n:o.AU.featureOptions[e]=n})),void 0!==i&&i&&(t=f(i)||{},Object.keys(t).forEach(function(e){var n=t[e];"sot"===e?o.NZ.sot=n:o.NZ.featureOptions[e]=n})),o.enhancedStateHandling="yes"===l,o.business.enabled="yes"===d,o.business.displayRetrievedName="yes"===c,void 0!==u)&&u&&(t=f(u)||{},Object.keys(t).forEach(function(e){o.business.featureOptions[e]=t[e]})),console.debug("Licence key is in "+(v?"VALID":"INVALID")+" format, URL: "+n+", Options: "+r+", AU Options: "+s+", NZ Options: "+i+", Email Enabled: "+p+", Email Options: "+m+", Phone Enabled: "+y+", Enhanced State: "+l+", Business Lookup Enabled: "+d+", Business Lookup Options: "+u),o}(),h=php_vars.nzRegionsValKey,f("#"+e+"country").data("val",f("#"+e+"country").val()),f("#"+n+"country").data("val",f("#"+n+"country").val()),f("#"+e+"country").length&&S(f("#"+e+"country").val(),e),f("#"+n+"country").length&&S(f("#"+n+"country").val(),n),f("#"+e+"email").length&&a(e,b.email),f("#"+n+"email").length&&a(n,b.email),f("#"+e+"phone").length&&r(e,b.phone),f("#"+n+"phone").length&&r(n,b.phone),f("#"+e+"company").length&&s(e,b.business),f("#"+n+"company").length&&s(n,b.business),O.initialize(),f("#billing_country").change(function(){o(e,b),f(this).data("val",f(this).val())}),f("#shipping_country").change(function(){o(n,b),f(this).data("val",f(this).val())})});